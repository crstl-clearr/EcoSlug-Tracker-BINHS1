<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoSlug Tracker - Application Log</title>
    <script>
        // Immediate theme initialization to prevent FOUC
        (function() {
            try {
                const theme = localStorage.getItem('theme') || 'system';
                const root = document.documentElement;
                
                // Remove any existing theme attributes first
                root.removeAttribute('data-theme');
                
                if (theme === 'light') {
                    root.setAttribute('data-theme', 'light');
                } else if (theme === 'dark') {
                    root.setAttribute('data-theme', 'dark');
                } else if (theme === 'system') {
                    // For system theme, check media query and set explicitly
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        root.setAttribute('data-theme', 'dark');
                    } else {
                        root.setAttribute('data-theme', 'light');
                    }
                }
            } catch (e) {
                // Fallback to light theme if localStorage fails
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();
    </script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="log-page">
    <div class="container">
        <header class="header">
            <button class="menu-button" onclick="toggleMenu()" title="Menu">
                <img src="images/menu-icon.svg" alt="Menu" style="width: 20px; height: 20px;">
            </button>
            
            <!-- Dropdown Menu -->
            <div id="menuDropdown" class="menu-dropdown">
                <button class="menu-item" onclick="openSettings()">
                    <img src="images/settings-icon.svg" alt="Settings" class="menu-item-icon">
                    Settings
                </button>
                <button class="menu-item" onclick="openAbout()">
                    <img src="images/about-icon.svg" alt="About" class="menu-item-icon">
                    About
                </button>
                <button class="menu-item" onclick="openTerms()">
                    <img src="images/terms-icon.svg" alt="Terms" class="menu-item-icon">
                    Terms and Conditions
                </button>
            </div>
            
            <!-- Menu Overlay -->
            <div id="menuOverlay" class="menu-overlay" onclick="closeMenu()"></div>
            
            <button class="back-button" onclick="navigateHome()" title="Back to Home">
                <img src="images/back-icon.svg" alt="Back" style="width: 20px; height: 20px;">
            </button>
            <div class="logo-container">
                <div class="logo-placeholder">
                    <img src="images/log-icon.svg" alt="Log" class="logo-icon" style="width: 60px; height: 60px;">
                </div>
            </div>
            <h1 class="app-title">Application Log</h1>
            <p class="app-subtitle">Track your pesticide applications</p>
        </header>

        <main class="log-container">
            <!-- Success/Error Messages -->
            <div id="messageContainer" style="display: none;"></div>

            <!-- Log Table -->
            <div class="log-table-container">
                <div class="log-header">
                    <h3>Application Records</h3>
                    <div class="log-stats">
                        <span id="totalEntries">0 entries</span>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table class="log-table" id="logTable">
                        <thead>
                            <tr>
                                <th>Entry #</th>
                                <th>Date Applied</th>
                                <th>Time Applied</th>
                                <th>Plant/Area Treated</th>
                                <th>Dosage/Amount</th>
                                <th>Notes/Remarks</th>
                                <th class="actions-column" style="display: none;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="logTableBody">
                            <!-- Entries will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="empty-icon">üìù</div>
                    <h3>No Applications Recorded</h3>
                    <p>Start logging your pesticide applications to track effectiveness and compliance.</p>
                    <button class="nav-button log-button" onclick="showEditModal()">
                        <img src="images/log-icon.svg" alt="Add" class="button-icon">
                        <span class="button-text">Add First Entry</span>
                    </button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3 style="text-align: center; margin-bottom: 1.5rem; color: #333;">Quick Actions</h3>
                <div class="button-group">
                    <button class="nav-button weather-button" onclick="navigateToWeather()">
                        <img src="images/weather-icon.svg" alt="Weather" class="button-icon">
                        <span class="button-text">Check Weather</span>
                    </button>
                    
                    <button class="nav-button pest-button" onclick="navigateToPestCount()">
                        <img src="images/pest-icon.svg" alt="Pest Count" class="button-icon">
                        <span class="button-text">Pest Count</span>
                    </button>

                    <button class="nav-button" onclick="exportLogData()" style="background: #235418;">
                        <span class="button-icon">üì§</span>
                        <span class="button-text">Export Log</span>
                    </button>
                </div>
            </div>

            <!-- Edit Button (Bottom Right) -->
            <button id="editButton" class="edit-fab" onclick="toggleEditMode()" title="Edit Log">
                <img src="images/edit-icon.svg" alt="Edit" style="width: 24px; height: 24px;">
            </button>

            <!-- Add Entry Button (shows in edit mode) -->
            <button id="addButton" class="add-fab" onclick="showEditModal()" title="Add Entry" style="display: none;">
                <span style="font-size: 24px; color: white;">+</span>
            </button>
        </main>
    </div>

    <!-- Edit/Add Entry Modal -->
    <div id="editModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Entry</h3>
                <button class="modal-close" onclick="hideEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="entryForm">
                    <input type="hidden" id="entryId" value="">
                    
                    <div class="form-group">
                        <label for="dateApplied">Date Applied:</label>
                        <input type="date" id="dateApplied" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="timeApplied">Time Applied:</label>
                        <input type="time" id="timeApplied" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="plantArea">Plant/Area Treated:</label>
                        <input type="text" id="plantArea" placeholder="e.g., Garden bed A, Tomato plants" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="dosageAmount">Dosage/Amount:</label>
                        <input type="text" id="dosageAmount" placeholder="e.g., 50ml per 1L water" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="notesRemarks">Notes/Remarks:</label>
                        <textarea id="notesRemarks" rows="3" placeholder="Additional notes, weather conditions, etc."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="hideEditModal()">Cancel</button>
                <button type="button" class="btn-save" onclick="saveEntry()">Save Entry</button>
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div id="modalOverlay" class="modal-overlay" style="display: none;" onclick="hideEditModal()"></div>

    <script src="js/theme.js"></script>
    <script src="js/main.js"></script>
    <script src="js/log.js"></script>
</body>
</html>
